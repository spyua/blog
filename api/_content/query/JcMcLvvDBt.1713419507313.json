[{"_path":"/web-backend/quarkus-reactive-web-api","_dir":"web-backend","_draft":false,"_partial":false,"_locale":"","title":"Quarkus Reactive Web API寫法紀錄","description":"近期因工作上需求，需要接觸新的後端框架...Quarkus，號稱有出色的啟動速度和低記憶體占用....因寫法上與一般Web API有點不同特別做個紀錄。","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"quarkus-reactive-web-api寫法紀錄"},"children":[{"type":"text","value":"Quarkus Reactive Web API寫法紀錄"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"近期因工作上需求，需要接觸新的後端框架...Quarkus，號稱有出色的啟動速度和低記憶體占用....因寫法上與一般Web API有點不同特別做個紀錄。"}]},{"type":"element","tag":"h2","props":{"id":"一restful-web-api-阻塞式非阻塞式響應式與併發差異性"},"children":[{"type":"text","value":"一、RESTful Web API 阻塞式、非阻塞式、響應式與併發差異性"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一般API常見的有四種寫法，分別為阻塞式、非阻塞式、響應式與併發的寫法。他們的差異如下"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"阻塞式 (Blocking) : 每個請求都必須等待前一個請求完成後才能繼續進行。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"非阻塞式 (Non-blocking) : 後續的請求不必等前一個請求完成，就可繼續進行。簡單來說就是允許系統在等待某個任務完成的同時，去做其他事情。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"響應式 (Reactive) : 基立於Non-blocking(Thread Pool)、事件驅動（Event-Driven）和觀察者模式（Observer Pattern），相較於Non-blocking更能輕易做數據流的整合與操作，能更優雅的處理好的反壓（back-pressure）和資源彈性（resource elasticity）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"併發 (Concurrency) : 基本上併發是一種概念，簡單來說只要涉及同時間有多個請求或操作在進行就可以叫併發? 而Non-blocking與Reactive就是一種併發的實現方式。"}]}]},{"type":"element","tag":"h3","props":{"id":"ablocking"},"children":[{"type":"text","value":"a.Blocking"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"下圖為Blocking Flow，這Flow很簡單，簡單來說HTTP GET/user/joe打出去後，Client要等到HTTP Response，後端服務(Container)才可以接受處理另一個HTTP Request。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Blocking Flow","src":"/blog/images/150/02/001.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Java範例程式碼如下"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"@GetMapping(\"/blocking\")\npublic String blocking() throws InterruptedException {\n    // Simulate a long-running operation\n    Thread.sleep(5000);\n    return \"Finished blocking operation\";\n}\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/blocking\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" String "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"blocking"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() throws InterruptedException {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// Simulate a long-running operation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    Thread."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Finished blocking operation\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"bnon-blocking"},"children":[{"type":"text","value":"b.Non-Blocking"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Non-Blocking Flow如下，可以看到一個Key Point，在Container往Controller呼叫getUser()當下立即返回一個Future HTTP Result。這個Future HTTP Result會告知Container可以去處理其他事情，已收到任務命令。Container就可以接著去接收下一個Request。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"詳細流程如下，基礎原理在Thread Pool與callback的應用實作"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"客戶端到容器（Container）"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step1 : Client發起HTTP GET請求，當客戶端（Client）發起一個HTTP GET到 /user/joe，這個請求首先會被送到容器（Container）。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"容器到Controller"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step1 : HTTP請求到達Controller，容器會將這個HTTP請求轉交給Controller對應的getUser()方法。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step2 : Controller回應Future HTTP Result，這裡的\"Future HTTP Result\"是一種占位符，告訴容器這個請求會被異步處理。Controller會立即回應，這樣容器就知道可以去處理其他請求。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Controller到Service"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step1 : Service方法開啟新執行緒，Controller會調用Service的getUserByName()方法。Service層會開啟一個新的執行緒（通常來自一個執行緒池(Thread Pool)）來處理這個請求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step2 : 釋放原始執行緒，一旦新的執行緒開始運行，用來處理原始HTTP請求的執行緒就會被釋放，返回到執行緒池中。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Service到Repository到Database"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step1 : 非同步操作和回調（Callbacks)，Service會進一步調用Repository的findAllByLastName()方法，然後Repository會非同步地與Database進行交互。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step2 : Repository回應給Service，Repository會回傳一個CompletableFuture給Service。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Service到Controller到容器"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step1 : Service回應給Controller，Service會將CompletableFuture回傳給Controller。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step2 : 回調由不同的執行緒執行：這個CompletableFuture一旦完成，它的回調會被一個不同的執行緒（也來自執行緒池）執行。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Step3 : 返回HTTP響應：最後，Controller會生成最終的HTTP響應（通常是CompletableFuture的實際內容）並回傳給容器，然後容器再回傳給客戶端。"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/blog/images/150/02/002.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Java範例程式碼如下"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"\n@RestController\npublic class NonBlockingController {\n\n    @GetMapping(\"/non-blocking\")\n    public CompletableFuture<String> nonBlocking() {\n        return CompletableFuture.supplyAsync(() -> {\n            try {\n                // Simulate a long-running operation\n                Thread.sleep(5000);\n            } catch (InterruptedException e) {\n                // Handle exception\n            }\n            return \"Finished non-blocking operation\";\n        });\n    }\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RestController\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"NonBlockingController"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/non-blocking\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" CompletableFuture<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"nonBlocking"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" CompletableFuture."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"supplyAsync"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// Simulate a long-running operation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                Thread."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            } "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" (InterruptedException "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"e"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// Handle exception\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Finished non-blocking operation\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"creactive"},"children":[{"type":"text","value":"c.Reactive"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"響應式是基立於Non-blocking(Thread Pool)的設計是上，並套用事件驅動（Event-Driven）和觀察者模式（Observer Pattern）設計模式。可以輕易達到資料流串接處理、back-pressure與resource elasticity。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這邊以flow圖去解釋要想個情境會稍微麻煩一些，故這小節紀錄Reactive，我想說直接以Srouce Code去解釋。"}]},{"type":"element","tag":"h4","props":{"id":"資料流串接處理"},"children":[{"type":"text","value":"資料流串接處理"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"響應式寫法可以輕易的讓你客製資料流串接，例如三支服務處理完後，再去做事情。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"舉個例子，假設你的系統需要從多個服務提供者（例如，不同的API或數據庫）中獲取數據，並且希望這些操作能夠非阻塞和高效地進行。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport reactor.core.publisher.Flux;\nimport reactor.core.publisher.Mono;\n\nimport java.time.Duration;\n\n@RestController\npublic class ReactiveController {\n\n    // 模擬從一個遠程API或數據庫中獲取單一數據\n    private Mono<String> getDataFromProvider1() {\n        return Mono.just(\"Data from Provider 1\")\n                   .delayElement(Duration.ofSeconds(2));\n    }\n\n    // 模擬從另一個遠程API或數據庫中獲取流式數據\n    private Flux<String> getDataFromProvider2() {\n        return Flux.just(\"Data 1 from Provider 2\", \"Data 2 from Provider 2\")\n                   .delayElements(Duration.ofSeconds(1));\n    }\n\n    @GetMapping(\"/aggregate\")\n    public Flux<String> aggregateData() {\n        // 合併兩個數據來源並返回\n        return Flux.concat(getDataFromProvider1(), getDataFromProvider2());\n    }\n}\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.GetMapping;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.RestController;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" reactor.core.publisher.Flux;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" reactor.core.publisher.Mono;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" java.time.Duration;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RestController\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ReactiveController"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 模擬從一個遠程API或數據庫中獲取單一數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Mono<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Mono."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"just"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data from Provider 1\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                   ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"delayElement"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Duration."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ofSeconds"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 模擬從另一個遠程API或數據庫中獲取流式數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"just"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data 1 from Provider 2\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data 2 from Provider 2\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                   ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"delayElements"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Duration."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ofSeconds"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/aggregate\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"aggregateData"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 合併兩個數據來源並返回\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"concat"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(), "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果用一般寫法要達到同效果，寫法如下，相對起來會較於複雜，使用Reactive我們可以輕易達到當兩個數據都收到資料時，在實際做下一步動作."}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"import org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.TimeUnit;\n\n@RestController\npublic class NonReactiveController {\n\n    // 模擬從一個遠程API或數據庫中獲取單一數據\n    private String getDataFromProvider1() {\n        try {\n            TimeUnit.SECONDS.sleep(2);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        return \"Data from Provider 1\";\n    }\n\n    // 模擬從另一個遠程API或數據庫中獲取流式數據\n    private List<String> getDataFromProvider2() {\n        List<String> data = new ArrayList<>();\n        data.add(\"Data 1 from Provider 2\");\n        try {\n            TimeUnit.SECONDS.sleep(1);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        data.add(\"Data 2 from Provider 2\");\n        return data;\n    }\n\n    @GetMapping(\"/aggregate\")\n    public List<String> aggregateData() {\n        List<String> aggregatedData = new ArrayList<>();\n        // 從第一個數據提供者獲取數據\n        aggregatedData.add(getDataFromProvider1());\n        // 從第二個數據提供者獲取數據\n        aggregatedData.addAll(getDataFromProvider2());\n        return aggregatedData;\n    }\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.GetMapping;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.RestController;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" java.util.ArrayList;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" java.util.List;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" java.util.concurrent.TimeUnit;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RestController\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"NonReactiveController"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 模擬從一個遠程API或數據庫中獲取單一數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" String "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            TimeUnit.SECONDS."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" (InterruptedException "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"e"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            Thread."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"currentThread"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"interrupt"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data from Provider 1\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 模擬從另一個遠程API或數據庫中獲取流式數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" List<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        List<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> data "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ArrayList<>();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        data."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data 1 from Provider 2\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            TimeUnit.SECONDS."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" (InterruptedException "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"e"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            Thread."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"currentThread"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"interrupt"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        data."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Data 2 from Provider 2\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" data;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/aggregate\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" List<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"aggregateData"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        List<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> aggregatedData "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ArrayList<>();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 從第一個數據提供者獲取數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        aggregatedData."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"add"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 從第二個數據提供者獲取數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        aggregatedData."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"addAll"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getDataFromProvider2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" aggregatedData;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"back-pressure"},"children":[{"type":"text","value":"back-pressure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"back-pressure為一種流量控制手段，當系統中的一個部分（通常是消費者）無法跟上另一個部分（通常是生產者）的速度時，它會發出一個信號，要求生產者減慢速度。換句話說，當系統過載時，響應式架構允許系統向上游（發送請求的來源）發出信號，告訴它「慢下來！」。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"舉個簡單例子，假設我們的後端API需要從多個數據源拉取數據，然後進行一些耗時的計算或轉換，最後將結果返回給客戶端。使用Reactive方法程式碼如下，"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個例子中，我們創建了一個Flowable流，用於模擬一個快速生成數據的數據源。這個流生成0到999的整數。然後，我們用BackpressureStrategy.BUFFER來指定背壓策略，這樣如果後續的操作（例如，存儲到數據庫或進行計算）無法跟上數據生成的速度，這些數據會被緩存起來。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們使用.observeOn(Schedulers.io())來指定後續操作應該在I/O線程上執行，以避免阻塞主線程。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個.blockingSubscribe()方法會阻塞當前線程直到流被完全消費。這裡只是為了簡單示範，實際應用中應避免使用阻塞調用。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"import io.reactivex.rxjava3.core.BackpressureStrategy;\nimport io.reactivex.rxjava3.core.Flowable;\nimport io.reactivex.rxjava3.schedulers.Schedulers;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class RxJavaBackPressureExampleController {\n\n    @GetMapping(\"/rxjava-backpressure-example\")\n    public String backPressureExample() {\n\n        Flowable<Integer> flowable = Flowable.create(emitter -> {\n            for (int i = 0; i < 1000; i++) {\n                emitter.onNext(i);\n            }\n            emitter.onComplete();\n        }, BackpressureStrategy.BUFFER);\n\n        StringBuilder result = new StringBuilder();\n\n        flowable.observeOn(Schedulers.io())\n                .blockingSubscribe(\n                        item -> {\n                            // 模擬耗時操作\n                            Thread.sleep(100);\n                            result.append(item).append(\", \");\n                        },\n                        throwable -> result.append(\"Error: \").append(throwable),\n                        () -> result.append(\"Done\")\n                );\n\n        return result.toString();\n    }\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" io.reactivex.rxjava3.core.BackpressureStrategy;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" io.reactivex.rxjava3.core.Flowable;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" io.reactivex.rxjava3.schedulers.Schedulers;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.GetMapping;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" org.springframework.web.bind.annotation.RestController;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RestController\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"RxJavaBackPressureExampleController"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/rxjava-backpressure-example\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" String "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"backPressureExample"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        Flowable<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> flowable "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flowable."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(emitter "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"; i "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"; i"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                emitter."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onNext"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(i);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            emitter."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onComplete"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        }, BackpressureStrategy.BUFFER);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        StringBuilder result "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"StringBuilder"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        flowable."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"observeOn"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Schedulers."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"io"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"blockingSubscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                        item "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                            "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 模擬耗時操作\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                            Thread."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sleep"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"100"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                            result."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(item)."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\", \""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                        },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                        throwable "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" result."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Error: \""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(throwable),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                        () "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" result."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"append"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Done\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                );\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" result."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"resource-elasticity"},"children":[{"type":"text","value":"resource elasticity"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"指一個系統能夠根據需求自動地調整其資源使用（例如，CPU、記憶體、帶寬等）。這邊舉個例子，"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一個圖片轉換服務為例。這個服務需要大量的CPU資源來進行圖片處理。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"情境描述"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用戶會上傳圖片進行格式轉換（例如，從JPEG轉為PNG）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在普通工作時間，只有少數請求。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在晚上或促銷活動期間，請求數量會劇增。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"我們希望系統能夠根據請求的量動態調整資源。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"程式碼如下，在這個例子中，我們使用了 Reactor 的 Elastic Scheduler。這個 Scheduler 會根據需要動態地創建或銷毀執行緒，從而達到資源彈性。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"// Controller\n@RestController\npublic class ImageController {\n    @Autowired\n    private ImageService imageService;\n\n    @PostMapping(\"/convert\")\n    public Mono<Void> convert(@RequestBody Flux<Image> images) {\n        return imageService.convertImages(images).then();\n    }\n}\n\n\n// Service\n@Service\npublic class ImageService {\n    public Flux<Image> convertImages(Flux<Image> images) {\n        return images.parallel()\n                     .runOn(Schedulers.elastic())  // 使用Elastic Scheduler\n                     .map(this::heavyImageProcessing)\n                     .sequential();\n    }\n\n    private Image heavyImageProcessing(Image image) {\n        // 耗CPU的圖片處理\n        return new Image();  // 返回轉換後的圖片\n    }\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// Controller\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RestController\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ImageController"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Autowired\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ImageService imageService;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"PostMapping"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"/convert\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Mono<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Void"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"convert"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"RequestBody"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Image"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"images"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" imageService."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"convertImages"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(images)."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// Service\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Service\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ImageService"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Flux<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Image"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"convertImages"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Flux<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Image"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"images"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" images."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"parallel"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                     ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"runOn"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Schedulers."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"elastic"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"())  "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 使用Elastic Scheduler\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                     ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"map"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"heavyImageProcessing)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                     ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"sequential"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Image "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"heavyImageProcessing"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Image "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"image"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 耗CPU的圖片處理\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"Image"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();  "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 返回轉換後的圖片\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"再舉個例子，你可以使用 Schedulers.io()如下 來自動地管理一個無界的線程池。根據需要創建更多的線程，並在完成後自動釋放，從而實現一種資源彈性。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Observable<String> observable = Observable.create(emitter -> {\n    emitter.onNext(\"Hello\");\n    emitter.onComplete();\n});\n\nobservable\n    .observeOn(Schedulers.io())\n    .subscribe(item -> {\n        // 這個操作將在 io Scheduler 上運行，具有資源彈性\n        System.out.println(item);\n    });\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Observable<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> observable "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Observable."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(emitter "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    emitter."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onNext"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Hello\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    emitter."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onComplete"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"observable\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"observeOn"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Schedulers."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"io"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(item "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 這個操作將在 io Scheduler 上運行，具有資源彈性\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        System.out."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"println"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(item);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    });"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"dreactive補充"},"children":[{"type":"text","value":"d.Reactive補充"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在純後端的情境中，非阻塞（Non-blocking）的實現方式通常已經足夠應對大多數的需求，特別是在處理 I/O 等待、資料庫查詢或網絡請求等方面。但Reactive還是有其特定的應用場景，最常見的就是事件驅動架構及流量控制（Back-Pressure）。針對這兩個應用再給個情境。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"流量控制（Back-Pressure）\n假設你有一個後端系統，它負責處理來自多個客戶端的圖片上傳。每個客戶端上傳的速度可能會不一樣。如果一個客戶端上傳速度非常快，而你的後端處理速度跟不上，這會造成資源過度使用或者其他客戶端的請求被延遲。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在這種情況下，你可以使用 Reactive 的 Back-Pressure 機制來控制接收速度。即，後端會告訴每個客戶端它目前可以接受的速度，這樣就不會因為一兩個過快的客戶端而影響整個系統。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在Java的世界中，這可以使用 Project Reactor 或者 RxJava 等庫來實現。以 Project Reactor 為例："}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Flux.create(sink -> {\n    // 生產數據的邏輯，可能是讀取一個快速的數據源\n})\n.onBackpressureBuffer() // 這裡就是使用了背壓機制，當速度過快時會緩存數據\n.subscribe(data -> {\n    // 處理數據的邏輯，可能是寫入一個慢速的數據源\n});\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Flux."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(sink "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 生產數據的邏輯，可能是讀取一個快速的數據源\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onBackpressureBuffer"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 這裡就是使用了背壓機制，當速度過快時會緩存數據\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(data "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 處理數據的邏輯，可能是寫入一個慢速的數據源\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"});"}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"事件驅動架構 (這範例有點爛...事件驅動架構是一個很大的Scope....)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在一個購物網站的後端，當用戶完成付款後，會有多個步驟需要同時進行，例如更新庫存、通知用戶、生成發票等。這些步驟之間相互獨立，但都是由「用戶完成付款」這一個事件觸發的。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在這種情況下，你可以使用事件驅動架構，當一個事件發生時，會通知（publish）給多個事件消費者（subscriber）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"例如，使用 Java 的 Spring Framework，你可以這樣做："}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"// 事件發布者\npublic class PaymentService {\n    @Autowired\n    private ApplicationEventPublisher publisher;\n\n    public void completePayment() {\n        // ...付款邏輯\n        publisher.publishEvent(new PaymentCompletedEvent(this));\n    }\n}\n\n// 事件消費者\npublic class StockService implements ApplicationListener<PaymentCompletedEvent> {\n    @Override\n    public void onApplicationEvent(PaymentCompletedEvent event) {\n        // ...更新庫存邏輯\n    }\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 事件發布者\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"PaymentService"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Autowired\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ApplicationEventPublisher publisher;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"completePayment"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// ...付款邏輯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        publisher."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"publishEvent"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"PaymentCompletedEvent"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 事件消費者\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"StockService"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"implements"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"ApplicationListener"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"PaymentCompletedEvent"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    @"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Override\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onApplicationEvent"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(PaymentCompletedEvent "}]},{"type":"element","tag":"span","props":{"class":"ct-157101"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// ...更新庫存邏輯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"每當 PaymentService 發布一個 PaymentCompletedEvent，所有訂閱了這個事件的服務（例如 StockService）都會收到通知，並執行相應的邏輯。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"非阻塞（Non-blocking）"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"一般是基於執行緒池（Thread Pool）來實現的。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"主要目的是讓執行緒可以在等待某個操作（如I/O操作或數據庫查詢）完成的期間，被釋放去做其他事情。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用Future、CompletableFuture或其他異步機制來表示未來會完成的結果。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"響應式（Reactive）"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"基於事件驅動（Event-Driven）和觀察者模式（Observer Pattern）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"更加關注數據流和變化的傳播，通常用於實現更為複雜的數據交互和流控制。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用Reactive Streams API或者相關的庫（如RxJava、Project Reactor等）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可以更好地處理背壓（Back-Pressure），即在高負載情況下控制數據流。"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"二quarkus-響應式與阻塞式寫法差異"},"children":[{"type":"text","value":"二、Quarkus 響應式與阻塞式寫法差異"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一般來說Rest都是使用Java EE提供的Servlet的這個類別來實踐，傳統的Rest服務皆是如此。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而在Quarkus從底層就採用了新的引擎Vert.x來實作，而Vert.x又別於Servlet的不同是，他基於netty進行實作，也就是他是基於異步高併發的事件驅動的應用程式框架，也代表說為什麼在使用Quarkus要以響應式編程來實作你的程式。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/blog/images/150/02/003.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"框架的底層架構就先大概知道這裡就好了，詳細的有機會再去更深入的了解，目前我們需要專注的是怎麼寫好Quarkus的程序，像是常聽到的Reactive的相關套件，在Java和JavaScript最有名的就是RX，像是Spring Flux就是基於rxJava去實作的框架，但Quarkus選用的非rxJava而是Mutiny這個一個套件。"}]},{"type":"element","tag":"h3","props":{"id":"a-阻塞-vs-非阻塞響應式寫法"},"children":[{"type":"text","value":"a. 阻塞 VS 非阻塞（響應式寫法）"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我現在有一個需求會有兩個資料原，並且要將兩個資料原彙整後再回傳，以下分別用阻塞和非阻塞的寫法來說明。"}]},{"type":"element","tag":"h4","props":{"id":"阻塞"},"children":[{"type":"text","value":"阻塞"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在以下的寫法必須先取得Data1後才能去發起請求取得Data2，因為此目的是要進行彙整，這樣我就會多了一個等待時間，導致程序在處理的速度較慢。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"public Data aggregateData() {\n    Data data1 = fetchDataFromDatabase();     // 請求資料庫，此時執行緒被阻塞\n    Data data2 = fetchDataFromExternalAPI();  // 請求外部 API，此時執行緒再次被阻塞\n    \n    return combine(data1, data2);             // 整合兩部分的資料\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Data "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"aggregateData"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    Data data1 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"fetchDataFromDatabase"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();     "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 請求資料庫，此時執行緒被阻塞\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    Data data2 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"fetchDataFromExternalAPI"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();  "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 請求外部 API，此時執行緒再次被阻塞\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"combine"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(data1, data2);             "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 整合兩部分的資料\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"非阻塞mutiny"},"children":[{"type":"text","value":"非阻塞(Mutiny)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而非阻塞再進行撰寫的時候，Data1和Data2是同時發出請求查詢資料，然後再進行彙整，這樣就可以減少要等待Data1查詢回來後的時間，這樣在程序處理的效能會比較快速。"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"public Uni<Data> aggregateData() {\n    Uni<Data> data1Uni = fetchDataFromDatabaseAsync();      // 非阻塞地請求資料庫\n    Uni<Data> data2Uni = fetchDataFromExternalAPIAsync();   // 非阻塞地請求外部 API\n    \n    return Uni.combine().all().unis(data1Uni, data2Uni)     // 同時等待兩個 Uni 完成\n             .asTuple()\n             .onItem().transform(tuple -> combine(tuple.getItem1(), tuple.getItem2()));\n}\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Data"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"aggregateData"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Data"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> data1Uni "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"fetchDataFromDatabaseAsync"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();      "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 非阻塞地請求資料庫\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Data"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> data2Uni "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"fetchDataFromExternalAPIAsync"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();   "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 非阻塞地請求外部 API\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"combine"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"unis"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(data1Uni, data2Uni)     "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 同時等待兩個 Uni 完成\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"             ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"asTuple"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"             ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onItem"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(tuple "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"combine"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(tuple."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getItem1"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(), tuple."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"getItem2"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"b-mutiny"},"children":[{"type":"text","value":"b. Mutiny"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在這個Mutiny主要提供了兩種介面來實踐Reactive如下列說明："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Uni<?>\n"},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"提供0個或一個執行結果的異步操作，可被做資料串流整合，通常單獨使用只有onItem(onSucess)與onFailure，兩種事件。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Multi<?>\n"},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"提供多個結果的異步操作，可以做資料串流整合，onItem與onFailure。"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在這裡還是要提醒一下，Reactive不管是rxJava還是Mutiny都是基於Functional Programing (函數式程式設計)，如果有寫過前端框架如Angular，Rest，Vue的人應該會相對熟悉。"}]},{"type":"element","tag":"h4","props":{"id":"uni-提供0個或1個執行結果的異步操作"},"children":[{"type":"text","value":"Uni 提供0個或1個執行結果的異步操作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Uni如果以Java原生的套件可以相當等於Future和CompletionStage。"}]},{"type":"element","tag":"h5","props":{"id":"create-uni"},"children":[{"type":"text","value":"Create Uni"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"//建立一個直接回傳值的Uni\nUni<String> uniFromValue = Uni.createFrom().item(\"Hello, Mutiny!\");\n\n//創建一個有邏輯處理過後的Uni\nUni<String> uniFromSupplier = Uni.createFrom().item(() -> {\n    // dosomething\n    return \"Async result\";\n});\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"//建立一個直接回傳值的Uni\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> uniFromValue "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Hello, Mutiny!\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"//創建一個有邏輯處理過後的Uni\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> uniFromSupplier "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// dosomething\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Async result\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"});"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"將completionstage轉換為uni"},"children":[{"type":"text","value":"將CompletionStage轉換為Uni"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Uni<String> uniFromCompletionStage = Uni.createFrom().completionStage(this::asyncMethod);\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> uniFromCompletionStage "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"completionStage"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"asyncMethod);"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"組合多個uni"},"children":[{"type":"text","value":"組合多個Uni"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Uni<String> uni1 = Uni.createFrom().item(\"Hello\");\nUni<String> uni2 = Uni.createFrom().item(\"Mutiny\");\n\nUni<String> combined = uni1.onItem()\n                           .combine()\n                           .with(uni2)\n                           .by((item1, item2) -> item1 + \" \" + item2);\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> uni1 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Hello\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> uni2 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Uni."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Mutiny\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> combined "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" uni1."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onItem"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                           ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"combine"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                           ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"with"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(uni2)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                           ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"by"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"((item1, item2) "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" item1 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\" \""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" item2);"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"錯誤處理"},"children":[{"type":"text","value":"錯誤處理"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Uni<String> recovered = uniFromValue\n    .onFailure()\n    .recoverWithItem(\"Fallback item in case of failure\");\n\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Uni<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> recovered "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" uniFromValue\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onFailure"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"recoverWithItem"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Fallback item in case of failure\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"非阻塞異步轉換為阻塞同步-這樣寫就變成同步了要注意"},"children":[{"type":"text","value":"非阻塞異步轉換為阻塞同步 (這樣寫就變成同步了要注意)"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"String result = uniFromValue.await().indefinitely();\nSystem.out.println(result); // 輸出：Hello, Mutiny!\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"String result "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" uniFromValue."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"indefinitely"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"System.out."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"println"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(result); "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 輸出：Hello, Mutiny!"}]}]}]}]},{"type":"element","tag":"h4","props":{"id":"multi-提供多個結果的異步操作"},"children":[{"type":"text","value":"Multi 提供多個結果的異步操作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"與 Uni 不同的是，Multi 可以表示多筆資料項目，例如來自資料庫的多筆記錄或者一系列的事件"}]},{"type":"element","tag":"h5","props":{"id":"create-multi"},"children":[{"type":"text","value":"Create Multi"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"// 創建一個集合的Multi\nMulti<String> names = Multi.createFrom().items(\"Alice\", \"Bob\", \"Charlie\");\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 創建一個集合的Multi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> names "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"items"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Alice\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Bob\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Charlie\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"過濾和轉換"},"children":[{"type":"text","value":"過濾和轉換"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Multi<Integer> lengths = names\n    .filter(name -> !name.equals(\"Bob\"))      // 過濾掉 \"Bob\"\n    .onItem().transform(String::length);      // 將名稱轉換為其長度\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> lengths "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" names\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(name "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"name."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"equals"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Bob\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))      "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 過濾掉 \"Bob\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onItem"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(String"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"length);      "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 將名稱轉換為其長度"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"錯誤處理-1"},"children":[{"type":"text","value":"錯誤處理"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Multi<String> processed = names\n    .onItem().transform(name -> {\n        if (name.equals(\"Bob\")) {\n            throw new RuntimeException(\"Bob not allowed!\");\n        }\n        return name;\n    })\n    .onFailure().recoverWithMulti(Multi.createFrom().item(\"Error occurred\"));\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> processed "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" names\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onItem"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(name "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" (name."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"equals"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Bob\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"throw"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"RuntimeException"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Bob not allowed!\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" name;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"onFailure"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"recoverWithMulti"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"Error occurred\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"));"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"合併"},"children":[{"type":"text","value":"合併"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Multi<String> multi1 = Multi.createFrom().items(\"A\", \"B\");\nMulti<String> multi2 = Multi.createFrom().items(\"C\", \"D\");\n\nMulti<String> merged = Multi.createBy().merging().streams(multi1, multi2);  // 輸出：A, B, C, D\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> multi1 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"items"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"A\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"B\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> multi2 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"items"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"C\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"D\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> merged "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createBy"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"merging"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"streams"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(multi1, multi2);  "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 輸出：A, B, C, D"}]}]}]}]},{"type":"element","tag":"h5","props":{"id":"連結"},"children":[{"type":"text","value":"連結"}]},{"type":"element","tag":"pre","props":{"className":"language-java github-light_github-dark","code":"Multi<String> multi1 = Multi.createFrom().items(\"A\", \"B\");\nMulti<String> multi2 = Multi.createFrom().items(\"C\", \"D\");\n\nMulti<String> concatenated = Multi.createBy().concatenating().streams(multi1, multi2);  // 輸出：A, B (等待完成), C, D\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> multi1 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"items"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"A\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"B\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> multi2 "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createFrom"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"items"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"C\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"\"D\""}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"Multi<"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"String"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"> concatenated "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" Multi."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"createBy"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"concatenating"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"streams"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"(multi1, multi2);  "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 輸出：A, B (等待完成), C, D"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"c-infrastructure撰寫注意"},"children":[{"type":"text","value":"c. Infrastructure撰寫注意"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"實作過程串接有遇到一些問題，實測串接MongoDB段，Quarkus有提供一個響應式DB物件叫ReactiveMongoClient。如果直接使用這個物件，他基底基本上就是使用Mutiny去包MongoDB官方的MogoClient物件，預設就是響應式寫法。但實際用起來有很大的問題，在資料MongoDB Collection資料量破千後，使用ReactiveMongoClient寫法實際跑起來會比阻塞的寫法還慢。稍微查一下，感覺這個"},{"type":"element","tag":"a","props":{"href":"https://github.com/quarkusio/quarkus/issues/36177","rel":["nofollow"]},"children":[{"type":"text","value":"Issue"}]},{"type":"text","value":"目前還是Open。所以建議寫法，還是自己使用Mutiny去包DB物件。"}]},{"type":"element","tag":"h3","props":{"id":"d-k6io測試結果"},"children":[{"type":"text","value":"d. K6.io測試結果"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/KCDC-Cloud-Dev/Research-Dummy/tree/feature-web-service-sample/quarkus-dummy/web-service-mongodb","rel":["nofollow"]},"children":[{"type":"text","value":"範例點我"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"針對範例程式去使用k6.io測試，模擬1000個user同時打API，並執行1000次結果如下，數據部分可以看到響應式寫法比阻塞式寫法在connecting時間差了7倍，成功率也比較高。這為簡單以極端例子去測試，做個簡易參考。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/blog/images/150/02/004.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"註:實際測試checks應該要達100%，通常有幾個原因，系統乘載量真的太大(極端模擬硬體Support不足)，不然就是程式碼真的寫得有問題。"}]},{"type":"element","tag":"h2","props":{"id":"reference"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://quarkus.pro/guides/getting-started-reactive.html","rel":["nofollow"]},"children":[{"type":"text","value":"https://quarkus.pro/guides/getting-started-reactive.html"}]},{"type":"element","tag":"a","props":{"href":"https://blog.csdn.net/Tong_Rui/article/details/110683703","rel":["nofollow"]},"children":[{"type":"text","value":"https://blog.csdn.net/Tong_Rui/article/details/110683703"}]},{"type":"element","tag":"a","props":{"href":"https://zhuanlan.zhihu.com/p/63228618","rel":["nofollow"]},"children":[{"type":"text","value":"https://zhuanlan.zhihu.com/p/63228618"}]},{"type":"element","tag":"a","props":{"href":"https://quarkus.io/blog/mutiny-back-pressure/","rel":["nofollow"]},"children":[{"type":"text","value":"https://quarkus.io/blog/mutiny-back-pressure/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://dassum.medium.com/building-a-reactive-restful-web-service-using-spring-boot-and-postgres-c8e157dbc81d","rel":["nofollow"]},"children":[{"type":"text","value":"https://dassum.medium.com/building-a-reactive-restful-web-service-using-spring-boot-and-postgres-c8e157dbc81d"}]},{"type":"element","tag":"a","props":{"href":"http://blog.nostratech.com/2018/12/building-reactive-rest-api-using-spring.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://blog.nostratech.com/2018/12/building-reactive-rest-api-using-spring.html"}]},{"type":"element","tag":"a","props":{"href":"https://howtodoinjava.com/spring-webflux/spring-webflux-tutorial/","rel":["nofollow"]},"children":[{"type":"text","value":"https://howtodoinjava.com/spring-webflux/spring-webflux-tutorial/"}]},{"type":"element","tag":"a","props":{"href":"https://engineering.linecorp.com/en/blog/reactive-streams-armeria-2","rel":["nofollow"]},"children":[{"type":"text","value":"https://engineering.linecorp.com/en/blog/reactive-streams-armeria-2"}]},{"type":"element","tag":"a","props":{"href":"https://smallrye.io/smallrye-mutiny/1.6.0/tutorials/creating-uni-pipelines/","rel":["nofollow"]},"children":[{"type":"text","value":"https://smallrye.io/smallrye-mutiny/1.6.0/tutorials/creating-uni-pipelines/"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":".github-light_github-dark{color:#24292e;background:#fff;}.dark .github-light_github-dark{color:#e1e4e8;background:#24292e;}.ct-553616{color:#24292E;}.dark .ct-553616{color:#E1E4E8;}.ct-149352{color:#D73A49;}.dark .ct-149352{color:#F97583;}.ct-952708{color:#032F62;}.dark .ct-952708{color:#9ECBFF;}.ct-762058{color:#6F42C1;}.dark .ct-762058{color:#B392F0;}.ct-086898{color:#6A737D;}.ct-617022{color:#005CC5;}.dark .ct-617022{color:#79B8FF;}.ct-157101{color:#E36209;}.dark .ct-157101{color:#FFAB70;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"一restful-web-api-阻塞式非阻塞式響應式與併發差異性","depth":2,"text":"一、RESTful Web API 阻塞式、非阻塞式、響應式與併發差異性","children":[{"id":"ablocking","depth":3,"text":"a.Blocking"},{"id":"bnon-blocking","depth":3,"text":"b.Non-Blocking"},{"id":"creactive","depth":3,"text":"c.Reactive"},{"id":"dreactive補充","depth":3,"text":"d.Reactive補充"}]},{"id":"二quarkus-響應式與阻塞式寫法差異","depth":2,"text":"二、Quarkus 響應式與阻塞式寫法差異","children":[{"id":"a-阻塞-vs-非阻塞響應式寫法","depth":3,"text":"a. 阻塞 VS 非阻塞（響應式寫法）"},{"id":"b-mutiny","depth":3,"text":"b. Mutiny"},{"id":"c-infrastructure撰寫注意","depth":3,"text":"c. Infrastructure撰寫注意"},{"id":"d-k6io測試結果","depth":3,"text":"d. K6.io測試結果"}]},{"id":"reference","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:150.web-backend:2. Quarkus Reactive Web API寫法紀錄.md","_source":"content","_file":"150.web-backend/2. Quarkus Reactive Web API寫法紀錄.md","_extension":"md"},{"_path":"/desktop/windowsformxxxx","_dir":"desktop","_draft":false,"_partial":false,"_locale":"","title":"WindowsForm找不到類型xxxx上的建構涵式","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"windowsform找不到類型xxxx上的建構涵式"},"children":[{"type":"text","value":"WindowsForm找不到類型xxxx上的建構涵式"}]},{"type":"element","tag":"h2","props":{"id":"情境"},"children":[{"type":"text","value":"情境"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"近期在設計DeskTop頁面時有遇到幾個頁面基底邏輯相同的狀況，於是特別設置Base Page去讓UC繼承使用。因為頁面其實長差不多，所以最後決定不使用參考引用而直接使用繼承。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"讓A(UC_3Dswitch_CalibrationFileManagement)繼承B(UC_3Dswitch_FileManagementBase)。"}]},{"type":"element","tag":"h2","props":{"id":"錯誤訊息"},"children":[{"type":"text","value":"錯誤訊息"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"編譯上都沒有問題，但此時再使用Design模式時，發生找不到類型錯誤如下"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Error Message","src":"/blog/images/02/01/001.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"解決方法"},"children":[{"type":"text","value":"解決方法"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"宣告無注入空的建構子，"}]}]}]},{"type":"element","tag":"pre","props":{"className":"language-csharp github-light_github-dark","code":"\n// 宣告無注入空的建構子\npublic UC_3Dswitch_FileManagementBase()\n{\n\n}\npublic UC_3Dswitch_FileManagementBase(AppSetting appSetting) \n{\n    ProductLineDataPath = appSetting.ProductLineDataPath;\n    SNFolderNameLength = appSetting.SNFolderNameLength;\n    InitializeComponent();\n}\n","language":"csharp","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"// 宣告無注入空的建構子\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"UC_3Dswitch_FileManagementBase"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"UC_3Dswitch_FileManagementBase"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"AppSetting"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"appSetting"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ProductLineDataPath "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" appSetting.ProductLineDataPath;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    SNFolderNameLength "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" appSetting.SNFolderNameLength;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"InitializeComponent"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"因原先Base設定注入所宣告AppSetting物件，故發生上述無法載入錯誤。看起來Deisnger模式在Control物件使用上Defaul都是預設空的建構子設置。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":".github-light_github-dark{color:#24292e;background:#fff;}.dark .github-light_github-dark{color:#e1e4e8;background:#24292e;}.ct-086898{color:#6A737D;}.ct-149352{color:#D73A49;}.dark .ct-149352{color:#F97583;}.ct-553616{color:#24292E;}.dark .ct-553616{color:#E1E4E8;}.ct-762058{color:#6F42C1;}.dark .ct-762058{color:#B392F0;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"情境","depth":2,"text":"情境"},{"id":"錯誤訊息","depth":2,"text":"錯誤訊息"},{"id":"解決方法","depth":2,"text":"解決方法"}]}},"_type":"markdown","_id":"content:2.desktop:1.WindowsForm找不到類型xxxx上的建構涵式.md","_source":"content","_file":"2.desktop/1.WindowsForm找不到類型xxxx上的建構涵式.md","_extension":"md"}]